(function(b,a){b.fn.djax=function(c,e,f){if(!history.pushState){return b(this)}var d=this,i=c,j=(e&&e.length)?e:[],g=(f)?f:b.fn.replaceWith,h=false;window.history.replaceState({url:window.location.href,title:b("title").text()},b("title").text(),window.location.href);d.clearDjaxing=function(){d.djaxing=false};d.attachClick=function(l,n){var m=b(l),k=false;b.each(j,function(o,p){if(m.attr("href").indexOf(p)!==-1){k=true}if(m.data("djax-exclude")===true){k=true}if(window.location.href.indexOf(p)!==-1){k=true}});if(k){return b(l)}n.preventDefault();if(d.djaxing){setTimeout(d.clearDjaxing,1000);return b(l)}b(window).trigger("djaxClick",[l]);d.reqUrl=m.attr("href");d.triggered=false;d.navigate(m.attr("href"),true)};d.navigate=function(k,m){var n=b(i);d.djaxing=true;b(window).trigger("djaxLoading",[{url:k}]);var l=function(p){if(k!==d.reqUrl){d.navigate(d.reqUrl,false);return true}var o=b(p),q=b(o).find(i);if(m){window.history.pushState({url:k,title:b(o).filter("title").text()},b(o).filter("title").text(),k)}b("title").text(b(o).filter("title").text());n.each(function(){var t="#"+b(this).attr("id"),s=q.filter(t),r=b(this);b("a",s).filter(function(){return this.hostname===location.hostname}).addClass("dJAX_internal").on("click",function(u){return d.attachClick(this,u)});if(s.length){if(r.html()!==s.html()){g.call(r,s)}}else{r.remove()}});b.each(q,function(){var t=b(this),s="#"+b(this).attr("id"),r;if(!b(s).length){r=b(o).find(s).prev();if(r.length){t.insertAfter("#"+r.attr("id"))}else{t.prependTo("#"+t.parent().attr("id"))}}b("a",t).filter(function(){return this.hostname===location.hostname}).addClass("dJAX_internal").on("click",function(u){return d.attachClick(this,u)})});if(!d.triggered){b(window).trigger("djaxLoad",[{url:k,title:b(o).filter("title").text(),response:p}]);d.triggered=true;d.djaxing=false}};b.get(k,function(o){l(o)}).error(function(o){console.log("error",o);l(o.responseText)})};b(this).find("a").filter(function(){return this.hostname===location.hostname}).addClass("dJAX_internal").on("click",function(k){return d.attachClick(this,k)});b(window).bind("popstate",function(k){d.triggered=false;if(k.originalEvent.state){d.reqUrl=k.originalEvent.state.url;d.navigate(k.originalEvent.state.url,false)}})}}(jQuery,window));